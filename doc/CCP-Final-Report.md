# 校园拼车系统期末大作业报告

## 1 标题和基本信息

| 项目名称 | 校园拼车系统 |
|---------|-------------|
| 课程名称 | 软件工程 |
| 作者姓名 | 张三 |
| 学号 | 20200001 |
| 指导老师 | 李四 |

## 2 项目简介

校园拼车系统是一个基于微信小程序和若依框架开发的校园出行服务平台，旨在为在校学生提供安全、便捷、经济的拼车服务。系统支持学生发布拼车需求、浏览拼车大厅、加入拼车订单、实时聊天沟通，并提供完善的后台管理功能，包括学校管理、校区管理、校门管理、用户认证审核、订单管理等。

系统采用前后端分离架构，后端基于Spring Boot和若依框架，前端包括管理端和小程序端，数据库采用MySQL存储。通过严格的实名认证和学校认证机制，确保用户身份真实性，提高系统安全性。

## 3 技术架构与选型概述

### 3.1 技术栈

| 类别 | 技术/框架 | 版本 |
|-----|---------|------|
| 后端框架 | Spring Boot | 2.7.x |
| 管理后台 | RuoYi | 4.7.x |
| 前端框架 | Vue.js | 2.x |
| UI组件库 | Element UI | 2.x |
| 小程序框架 | 微信小程序框架 | 稳定版 |
| 小程序UI库 | ccp-mp-ui | 自定义 |
| 数据库 | MySQL | 8.0 |
| ORM框架 | MyBatis | 3.x |
| 身份验证 | JWT | - |
| 构建工具 | Maven | 3.6+ |
| 前端包管理 | npm | 6.x+ |

### 3.2 模块划分

1. **ruoyi-admin**：管理后台API，包含系统管理、用户管理、认证审核等功能
2. **ruoyi-ui**：管理后台前端，基于Vue.js和Element UI开发
3. **ccp-miniprogram**：小程序后端API，处理小程序端请求
4. **ccp-mp-ui**：小程序前端，基于微信小程序框架开发
5. **ccp-core**：核心业务逻辑层，包含所有业务模块的Service实现
6. **ccp-common**：公共组件层，包含通用的DTO、VO、工具类等

## 4 需求与功能概述

### 4.1 核心功能需求

#### 4.1.1 小程序端功能
- 微信登录和账号管理
- 实名认证和学校认证
- 拼车发布（立即出行/预约出行）
- 拼车大厅浏览和筛选
- 拼车加入、退出、确认
- 行程聊天和消息通知
- 订单管理和历史记录
- 个人中心和常用路线管理

#### 4.1.2 管理端功能
- 学校、校区、校门管理
- 校外地点管理
- 小程序用户管理
- 实名认证和学校认证审核
- 拼车订单管理和干预
- 用户信誉和评价管理
- 系统配置和日志管理

### 4.2 非功能性需求
- **性能**：支持1000并发用户访问，响应时间≤200ms
- **安全**：JWT认证、数据脱敏、SQL注入防护、XSS防护
- **可用性**：页面引导友好、错误提示清晰、移动端体验优化
- **可扩展性**：支持多学校、多城市，模块化设计便于扩展

## 5 系统设计与实现要点

### 5.1 分层结构

系统采用经典的三层架构设计：

1. **表现层**：包含ruoyi-ui和ccp-mp-ui，负责与用户交互
2. **业务逻辑层**：包含ruoyi-admin、ccp-miniprogram、ccp-core和ccp-common，负责处理业务逻辑
3. **数据访问层**：包含MyBatis Mapper和MySQL数据库，负责数据存储和访问

### 5.2 模块划分

系统主要分为以下业务模块：

1. **用户与认证模块**：处理登录、注册、实名认证、学校认证等
2. **学校与校区管理模块**：管理学校、校区、校门等基础信息
3. **拼车行程模块**：处理拼车发布、加入、确认、订单流转等
4. **聊天与消息模块**：处理行程聊天、消息通知等
5. **用户信誉与评价模块**：管理用户信誉评分、评价记录等
6. **黑名单与风控模块**：处理用户封禁、解封、异常行为监控等
7. **定时任务模块**：处理订单状态自动更新、超时订单处理等

### 5.3 订单状态机设计

拼车订单有以下状态流转：

```
招募中（0） → 待确认（1） → 已确认（2） → 已完成（3）
       ↑       ↓           ↓           ↓
       └─── 已取消（4） ←── ┴─── 已过期（5）
```

- **招募中**：订单刚发布，等待用户加入
- **待确认**：人数已满或发起者手动确认，等待所有成员确认
- **已确认**：所有成员已确认，即将出发
- **已完成**：行程已结束
- **已取消**：订单被取消（发起人取消、成员取消或系统超时）
- **已过期**：订单超时未成团

### 5.4 聊天与已读设计

- 使用ccp_trip_chat表存储聊天消息
- 使用ccp_trip_chat_read表存储消息已读状态
- 支持文本消息和系统消息
- 系统自动生成加入、退出、确认等系统消息
- 实现未读消息统计功能

### 5.5 认证链路设计

核心约束：小程序必须在"实名通过 + 至少一个学校认证通过"后才能使用拼车核心功能

认证链路：
1. 用户登录小程序
2. 系统检查用户实名认证状态
3. 系统检查用户学校认证状态
4. 只有当实名认证通过且至少一个学校认证通过时，才允许使用拼车核心功能
5. 否则，引导用户完成认证

## 6 与大模型协作的全过程记录

### 6.1 协作模式

采用"主ChatGPT + 次级Codex模型"的协作模式：

1. **主ChatGPT**：负责理解业务需求、梳理逻辑、生成精确的提示词，扮演系统架构师和提示词工程师的角色
2. **次级Codex模型**：专注于代码生成，根据主ChatGPT提供的精确提示词生成代码

### 6.2 协作过程

#### 6.2.1 需求分析与设计阶段

1. **需求梳理**：将模糊的需求描述转化为清晰的功能点列表
2. **架构设计**：与大模型讨论系统架构、技术选型、模块划分
3. **数据库设计**：生成数据库表结构设计，包括表名、字段、索引、关系等
4. **接口设计**：设计RESTful API接口，包括URL、请求方法、参数、返回结构等

#### 6.2.2 代码生成阶段

1. **主ChatGPT预处理**：将复杂上下文转化为结构化、明确的开发任务描述
2. **生成精确提示词**：包含必要的上下文、接口定义、Domain类、Mapper约定等
3. **Codex模型生成代码**：根据提示词生成Controller、Service、Mapper、DTO、VO等代码
4. **代码审查与调整**：人工审查生成的代码，调整不符合规范或逻辑错误的部分

#### 6.2.3 文档编写阶段

1. **自动生成文档框架**：根据代码结构自动生成需求说明书、概要设计文档、详细设计文档、数据库设计文档等
2. **人工补充内容**：填写文档中的详细描述、业务流程、协作过程等
3. **文档格式调整**：调整文档格式，确保符合要求

### 6.3 上下文链接方式

由于大模型不读取本地文件系统，需要人为复制关键片段：

1. 向大模型粘贴数据库建表语句
2. 粘贴已有接口文档
3. 粘贴现有代码片段
4. 粘贴系统配置信息

### 6.4 提示词优化策略

1. **从模糊到精确**：逐步细化提示词，从模糊描述的需求打磨成包含路径、精确字段、URL、参数的提示词
2. **约束生成范围**：明确指定"不要新建重复Controller"、"不要修改现有语义"等规则
3. **提供上下文**：包含必要的类定义、接口规范、命名约定等
4. **使用结构化描述**：采用清晰的层级结构和格式，便于大模型理解

### 6.5 遇到的问题与解决办法

#### 6.5.1 接口重复问题
- **问题**：生成的接口与现有接口重复
- **解决办法**：在提示词中明确指定现有接口路径，避免重复生成

#### 6.5.2 路径冲突问题
- **问题**：生成的API路径与现有路径冲突
- **解决办法**：在提示词中指定API前缀，如/mp/或/ccp/

#### 6.5.3 Bean名冲突问题
- **问题**：生成的Bean与现有Bean重名
- **解决办法**：在提示词中指定Bean名称前缀或后缀，确保唯一性

#### 6.5.4 JWT配置问题
- **问题**：生成的JWT配置与若依框架冲突
- **解决办法**：在提示词中明确指定使用若依框架的JWT配置，不要重新生成

#### 6.5.5 代码风格不一致问题
- **问题**：生成的代码风格与现有代码不一致
- **解决办法**：在提示词中明确指定代码风格、命名约定、注释规范等

### 6.6 与大模型协作的体会

#### 6.6.1 优点
- **提高开发效率**：大幅提高文档和样板代码编写速度，便于快速迭代
- **降低入门门槛**：对于不熟悉的技术栈，大模型可以生成基础代码，降低学习成本
- **提供设计参考**：可以与大模型讨论设计方案，获取不同的设计思路
- **减少重复工作**：自动生成重复的代码结构，减少机械劳动

#### 6.6.2 缺点
- **需要详细上下文**：大模型需要大量详细的上下文信息，否则生成的代码可能不符合要求
- **缺乏业务理解**：大模型缺乏对业务的深入理解，生成的代码可能存在逻辑问题
- **需要人工把关**：生成的代码需要人工严格审查，确保正确性和安全性
- **版本依赖问题**：大模型可能生成过时的API或依赖，需要人工更新

## 7 实际开发流程与迭代

### 7.1 开发里程碑

1. **初始数据库设计**：生成数据库表结构，包括用户表、学校表、校区表、校门表、拼车表等
2. **嵌入若依框架**：将核心业务模块嵌入若依框架，实现基础管理功能
3. **实现基础模块**：开发学校管理、校区管理、校门管理等基础功能
4. **实现登录与用户体系**：开发微信登录、JWT认证、用户信息管理等
5. **实现认证流程**：开发实名认证、学校认证的提交和审核流程
6. **实现拼车核心模块**：开发拼车发布、加入、确认、订单流转等核心功能
7. **实现聊天功能**：开发行程聊天、消息通知、已读状态等
8. **扩展后台管理**：开发用户管理、地点管理、审核管理等扩展功能

### 7.2 典型迭代过程

#### 7.2.1 需求变更：增加学校认证功能

1. **需求分析**：用户需要通过学校认证才能使用拼车功能
2. **设计调整**：在数据库中增加ccp_user_school_auth表，记录用户学校认证信息
3. **代码调整**：
   - 增加学校认证Controller和Service
   - 调整拼车功能的访问控制，增加学校认证检查
   - 增加后台审核功能
4. **文档更新**：更新需求说明书、概要设计文档、详细设计文档和数据库设计文档

#### 7.2.2 需求变更：优化拼车大厅筛选功能

1. **需求分析**：用户需要更灵活的筛选条件
2. **设计调整**：增加按出发时间、目的地、人数等筛选条件
3. **代码调整**：
   - 调整拼车列表查询接口，增加筛选参数
   - 优化前端拼车大厅页面，增加筛选控件
4. **文档更新**：更新需求说明书和详细设计文档

## 8 总结与展望

### 8.1 项目完成度评价

- **功能完整性**：已实现核心功能，包括拼车发布、加入、确认、聊天、认证审核、后台管理等
- **可用性**：界面友好，操作流程清晰，便于用户使用
- **安全性**：实现了严格的实名认证和学校认证机制，确保用户身份真实性
- **可扩展性**：模块化设计，便于后续扩展新功能

### 8.2 不足之处

1. **并发处理**：当前设计对并发场景考虑不足，需要进一步优化
2. **大规模使用**：对于大规模用户使用，需要考虑分表分库、缓存优化等
3. **地图集成**：未集成地图服务，无法提供路线规划和距离计算功能
4. **支付功能**：未实现在线支付功能，无法处理车费结算
5. **移动端体验**：小程序端的UI和交互体验可以进一步优化

### 8.3 未来可扩展方向

1. **接入地图服务**：集成地图API，支持路线规划、距离计算、车费预估等
2. **增强风控策略**：实现自动识别恶意用户或异常行为，提高系统安全性
3. **优化前端体验**：提供多主题、多学校品牌化等个性化设置
4. **支持多交通工具**：扩展支持共享单车、电动车等多种交通工具的拼车
5. **增加社交功能**：支持用户关注、好友推荐、社交分享等
6. **数据分析与报表**：提供更丰富的数据分析和报表功能，帮助管理员了解系统运行情况
7. **支持第三方登录**：除微信登录外，支持其他第三方登录方式

### 8.4 利用大模型辅助开发的总结

通过与大模型协作开发校园拼车系统，我深刻体会到了大模型在软件工程中的价值和潜力。大模型可以大幅提高文档和样板代码的编写速度，便于快速迭代和原型开发。然而，大模型也存在一些局限性，需要人工严格把关和提供详细上下文，否则容易产生与实际代码不一致的内容。

在未来的开发中，我将继续探索与大模型的协作模式，优化提示词生成策略，提高协作效率。同时，我也将更加重视代码审查和测试，确保生成的代码质量和安全性。

## 9 参考文献

1. Spring Boot官方文档：https://spring.io/projects/spring-boot
2. RuoYi框架文档：https://doc.ruoyi.vip/
3. 微信小程序开发文档：https://developers.weixin.qq.com/miniprogram/dev/framework/
4. MyBatis官方文档：https://mybatis.org/mybatis-3/zh/index.html
5. Vue.js官方文档：https://cn.vuejs.org/v2/guide/
6. Element UI官方文档：https://element.eleme.cn/#/zh-CN

## 10 附录

### 10.1 项目结构

```
ccp/
├── ccp-common/          # 公共组件
├── ccp-core/            # 核心业务逻辑
├── ccp-miniprogram/      # 小程序后端API
├── ccp-mp-ui/            # 小程序前端
├── doc/                  # 项目文档
├── ruoyi-admin/          # 管理后台API
├── ruoyi-ui/             # 管理后台前端
├── sql/                  # 数据库脚本
├── .gitignore
├── LICENSE
├── README.md
├── pom.xml
```

### 10.2 核心API列表

#### 10.2.1 小程序API

| API路径 | 方法 | 功能 |
|--------|-----|------|
| /mp/auth/login | POST | 微信登录 |
| /mp/real-auth/submit | POST | 提交实名认证 |
| /mp/school-auth/submit | POST | 提交学校认证 |
| /mp/trip/publish | POST | 发布拼车 |
| /mp/trip/list | GET | 获取拼车列表 |
| /mp/trip/join | POST | 加入拼车 |
| /mp/trip/quit | POST | 退出行程 |
| /mp/trip/confirm | POST | 确认拼车 |
| /mp/chat/list | GET | 获取聊天消息 |
| /mp/chat/send | POST | 发送聊天消息 |

#### 10.2.2 管理端API

| API路径 | 方法 | 功能 |
|--------|-----|------|
| /ccp/school/list | GET | 获取学校列表 |
| /ccp/campus/add | POST | 添加校区 |
| /ccp/gate/update | PUT | 更新校门 |
| /ccp/mini-user/list | GET | 获取用户列表 |
| /ccp/user/real-auth/audit | PUT | 审核实名认证 |
| /ccp/user/school-auth/audit | PUT | 审核学校认证 |
| /ccp/trip/list | GET | 获取拼车订单列表 |
| /ccp/trip/detail | GET | 获取订单详情 |

### 10.3 数据库表结构

系统包含以下主要业务表：

1. **用户相关**：ccp_mini_user、ccp_user_school_auth、ccp_user_emergency_contact、ccp_user_blacklist、ccp_user_reputation
2. **学校相关**：ccp_school、ccp_school_campus、ccp_school_gate
3. **拼车相关**：ccp_trip、ccp_trip_member、ccp_trip_chat、ccp_trip_chat_read、ccp_trip_log、ccp_trip_review
4. **地点相关**：ccp_location、ccp_location_stats
5. **路线相关**：ccp_route_preset、ccp_route_stats、ccp_user_route

详细表结构请参考项目中的数据库设计文档。

## 11 致谢

感谢指导老师在项目开发过程中的指导和帮助，感谢团队成员的协作和支持。同时，感谢开源社区提供的优秀框架和工具，使项目开发更加高效和便捷。特别感谢大模型在代码生成和文档编写方面的辅助，大幅提高了开发效率。