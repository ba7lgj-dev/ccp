<view class="page">
  <!-- <view class="top-header" wx:if="{{!loginRequired}}">
    <view class="user-touch" bindtap="onGoProfile">
      <image class="avatar" src="{{(userInfo && userInfo.avatarUrl) || '/assets/logo.png'}}" mode="aspectFill"></image>
      <view class="user-meta">
        <text class="greeting">æ¬¢è¿å›æ¥ï¼Œ{{(userInfo && userInfo.nickName) || 'åŒå­¦'}}</text>
        <text class="sub">è¯·å®Œå–„èµ„æ–™å¹¶ä¿æŒå®åè®¤è¯</text>
      </view>
    </view>
  </view> -->

  <block wx:if="{{loginRequired}}">
    <view class="card card-shadow">
      <view class="card-title-row">
        <text class="card-title">æœªç™»å½•</text>
        <text class="tag weak">éœ€è¦ç™»å½•</text>
      </view>
      <text class="card-desc">ç™»å½•åå¯æŸ¥çœ‹å­¦æ ¡ã€å‘å¸ƒè¡Œç¨‹ä¸èŠå¤©</text>
      <button class="primary-btn" type="primary" bindtap="onGoLogin">å»ç™»å½•</button>
    </view>
  </block>

  <block wx:else>
    <view class="card card-shadow campus-card">
      <view class="card-title-row">
        <view class="title-stack">
          <text class="card-title">å½“å‰å­¦æ ¡</text>
          <text class="card-subtitle">åªæ˜¾ç¤ºå½“å‰å­¦æ ¡ä¸æ ¡åŒºçš„è¡Œç¨‹</text>
        </view>
        <button class="mini-switch" size="mini" bindtap="onSwitchSchool">åˆ‡æ¢</button>
      </view>
      <view class="campus-row">
        <text class="label">å­¦æ ¡</text>
        <text class="value {{!selectedSchool ? 'warning' : ''}}">{{(selectedSchool && selectedSchool.schoolName) || 'è¯·å…ˆé€‰æ‹©å­¦æ ¡'}}</text>
      </view>
      <view class="campus-row">
        <text class="label">æ ¡åŒº</text>
        <text class="value {{!selectedCampus ? 'warning' : ''}}">{{(selectedCampus && selectedCampus.campusName) || 'è¯·å…ˆé€‰æ‹©æ ¡åŒº'}}</text>
      </view>
    </view>

    <view class="card card-shadow quick-card">
      <view class="card-title-row">
        <text class="card-title">å¿«é€Ÿå…¥å£</text>
        <text class="card-subtitle">å‘å¸ƒ/åŠ å…¥/æŸ¥çœ‹è®¢å•</text>
      </view>
      <view class="quick-grid">
        <view class="quick-item" bindtap="onGoPublish">
          <view class="quick-icon">ğŸš—</view>
          <text class="quick-text">å‘å¸ƒæ‹¼è½¦</text>
        </view>
        <view class="quick-item" bindtap="onGoHall">
          <view class="quick-icon">ğŸ§­</view>
          <text class="quick-text">æ‹¼å•å¤§å…</text>
        </view>
        <view class="quick-item" bindtap="onGoOrders">
          <view class="quick-icon">ğŸ“„</view>
          <text class="quick-text">æˆ‘çš„è®¢å•</text>
        </view>
      </view>
    </view>

    <view class="card card-shadow" wx:if="{{activeTrip}}" bindtap="onTapActiveTrip">
      <view class="card-title-row">
        <text class="card-title">è¿›è¡Œä¸­çš„è¡Œç¨‹</text>
        <text class="status-tag">{{activeTrip.statusText || 'è¿›è¡Œä¸­'}} </text>
      </view>
      <view class="trip-row">
        <text class="address">{{activeTrip.startAddress}}</text>
        <text class="arrow">â†’</text>
        <text class="address">{{activeTrip.endAddress}}</text>
      </view>
      <view class="trip-meta">
        <text class="meta">{{activeTrip.departureTimeDisplay}}</text>
        <text class="meta">{{activeTrip.joinedCount}} / {{activeTrip.totalCount}}äºº</text>
      </view>
    </view>

    <view class="card card-shadow history-card">
      <view class="card-title-row">
        <text class="card-title">æœ€è¿‘è¡Œç¨‹</text>
        <text class="card-subtitle">æœ€è¿‘ 3 æ¡è®¢å•æ¦‚è§ˆ</text>
      </view>
      <block wx:if="{{historyLoading}}">
        <view class="skeleton" wx:for="{{[1,2,3]}}" wx:key="*this"></view>
      </block>
      <block wx:elif="{{myHistoryTrips.length}}">
        <block wx:for="{{myHistoryTrips}}" wx:key="tripId">
          <view class="history-item" bindtap="onTapHistoryTrip" data-id="{{item.tripId}}">
            <view class="history-main">
              <text class="address">{{item.startAddress}}</text>
              <text class="arrow">â†’</text>
              <text class="address">{{item.endAddress}}</text>
            </view>
            <view class="history-meta">
              <text class="time">{{item.departureTimeText}}</text>
              <view class="status-chip">{{item.statusText}}</view>
            </view>
          </view>
        </block>
      </block>
      <block wx:else>
        <view class="empty">
          <image class="empty-icon" src="/assets/empty.png" mode="aspectFit"></image>
          <text class="empty-text">è¿˜æ²¡æœ‰è¡Œç¨‹ï¼Œå¿«å»å‘å¸ƒæˆ–åŠ å…¥ä¸€ä¸ªæ‹¼è½¦å§</text>
        </view>
      </block>
    </view>
  </block>
</view>
