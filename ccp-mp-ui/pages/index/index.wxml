<view class="page">
  <view class="hero">
    <text class="title">校园拼车 CCP</text>
    <text class="subtitle">登录后选择学校和校区即可开始拼车</text>
  </view>

  <block wx:if="{{loginRequired}}">
    <view class="card">
      <text class="card-title">未登录</text>
      <text class="card-desc">登录后可查看已选学校、发布行程</text>
      <button class="primary-btn" type="primary" bindtap="onGoLogin">去登录</button>
    </view>
  </block>

  <block wx:else>
    <view class="card">
      <text class="card-title">当前账户</text>
      <view class="user-row">
        <image class="avatar" src="{{(userInfo && userInfo.avatarUrl) || '/assets/logo.png'}}" mode="aspectFill"></image>
        <view class="user-info">
          <text class="nickname">{{(userInfo && userInfo.nickName) || '未设置昵称'}}</text>
          <text class="uid">ID：{{(userInfo && userInfo.id) || '未知'}}</text>
        </view>
      </view>
    </view>

    <view class="card active-card" wx:if="{{activeTrip}}" bindtap="onTapActiveTrip">
      <text class="card-title">你有一个进行中的拼车</text>
      <view class="active-row">
        <text class="start">{{activeTrip.startAddress}}</text>
        <text class="arrow">→</text>
        <text class="end">{{activeTrip.endAddress}}</text>
      </view>
      <view class="active-meta">
        <text class="status">{{activeTrip.statusText}}</text>
        <text class="time">{{activeTrip.departureTimeDisplay}}</text>
      </view>
    </view>

    <view class="card">
      <text class="card-title">当前选择</text>
      <view class="selection-row">
        <text class="label">学校</text>
        <text class="value">{{(selectedSchool && selectedSchool.schoolName) || '未选择'}}</text>
      </view>
      <view class="selection-row">
        <text class="label">校区</text>
        <text class="value">{{(selectedCampus && selectedCampus.campusName) || '未选择'}}</text>
      </view>
    </view>

    <view class="actions">
      <button class="primary-btn" type="primary" bindtap="onGoPublish">去发布拼车</button>
      <button class="ghost-btn" bindtap="onGoHall">前往拼单大厅</button>
    </view>

    <view class="card history-card">
      <text class="card-title">我的历史订单</text>
      <block wx:if="{{myHistoryTrips.length}}">
        <block wx:for="{{myHistoryTrips}}" wx:key="tripId">
          <view class="history-item" bindtap="onTapHistoryTrip" data-id="{{item.tripId}}">
            <view class="history-row main">
              <text class="address">{{item.startAddress}}</text>
              <text class="arrow">→</text>
              <text class="address">{{item.endAddress}}</text>
              <text class="owner-tag" wx:if="{{item.isOwner}}">发起者</text>
            </view>
            <view class="history-row time">{{item.departureTimeText}}</view>
            <view class="history-row status">{{item.statusText}}</view>
          </view>
        </block>
      </block>
      <block wx:else>
        <text class="empty-hint">暂无历史订单</text>
      </block>
    </view>
  </block>
</view>
