<view class="page">
  <view class="tabs">
    <view class="tab {{activeTab==='mine'?'active':''}}" data-tab="mine" bindtap="switchTab">我的认证</view>
    <view class="tab {{activeTab==='apply'?'active':''}}" data-tab="apply" bindtap="switchTab">申请认证</view>
  </view>
  <view wx:if="{{activeTab==='mine'}}" class="panel">
    <view wx:if="{{loading}}" class="hint">加载中...</view>
    <view wx:else>
      <view wx:if="{{!myList.length}}" class="hint">暂无认证记录</view>
      <block wx:for="{{myList}}" wx:key="id">
        <view class="card" bindtap="showDetail" data-item="{{item}}">
          <view class="card-title">{{item.schoolName}} {{item.campusName}}</view>
          <view class="card-desc">{{item.studentName}} / {{item.studentNo}}</view>
          <view class="card-status">状态：{{item.status}}</view>
          <view class="card-reason" wx:if="{{item.failReason}}">原因：{{item.failReason}}</view>
        </view>
      </block>
    </view>
  </view>
  <view wx:if="{{activeTab==='apply'}}" class="panel">
    <picker mode="selector" range="{{schoolOptions}}" range-key="schoolName" bindchange="onSelectSchool">
      <view class="picker">学校：{{applyForm.schoolName || '请选择学校'}}</view>
    </picker>
    <picker mode="selector" range="{{campusOptions}}" range-key="campusName" bindchange="onSelectCampus">
      <view class="picker">校区：{{applyForm.campusName || '请选择校区'}}</view>
    </picker>
    <view class="form-item">
      <text class="label">姓名</text>
      <input class="input" placeholder="请输入姓名" value="{{applyForm.studentName}}" data-field="studentName" bindinput="onInput" />
    </view>
    <view class="form-item">
      <text class="label">学号</text>
      <input class="input" placeholder="请输入学号" value="{{applyForm.studentNo}}" data-field="studentNo" bindinput="onInput" />
    </view>
    <view class="upload">
      <button bindtap="uploadStudentCard">上传学生证照片</button>
      <image wx:if="{{applyForm.studentCardImageUrl}}" src="{{applyForm.studentCardImageUrl}}" class="preview" mode="aspectFill" />
    </view>
    <view class="upload">
      <button bindtap="uploadExtra">上传补充材料（可选）</button>
      <image wx:if="{{applyForm.extraImageUrl}}" src="{{applyForm.extraImageUrl}}" class="preview" mode="aspectFill" />
    </view>
    <button class="submit" type="primary" loading="{{submitting}}" disabled="{{submitting}}" bindtap="submitApply">提交认证申请</button>
  </view>
  <view wx:if="{{detailVisible}}" class="modal">
    <view class="modal-body">
      <view class="modal-title">{{detailItem.schoolName}} {{detailItem.campusName}}</view>
      <view>姓名：{{detailItem.studentName}}</view>
      <view>学号：{{detailItem.studentNo}}</view>
      <view>状态：{{detailItem.status}}</view>
      <view wx:if="{{detailItem.failReason}}">原因：{{detailItem.failReason}}</view>
      <view class="modal-actions">
        <button bindtap="closeDetail">关闭</button>
        <button wx:if="{{detailItem.status==3 || detailItem.status==4}}" type="primary" bindtap="reapply" data-item="{{detailItem}}">重新申请</button>
      </view>
    </view>
  </view>
</view>
