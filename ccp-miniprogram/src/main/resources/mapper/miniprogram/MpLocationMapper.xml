<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- 命名空间必须和 Mapper 接口全类名一致 -->
<mapper namespace="org.ba7lgj.ccp.miniprogram.mapper.MpLocationMapper">

    <!-- 显式定义结果映射（推荐：字段映射更清晰，不受驼峰配置影响） -->
    <resultMap id="MpLocationResultMap" type="org.ba7lgj.ccp.miniprogram.domain.MpLocation">
        <!-- 主键映射 -->
        <id column="id" property="id"/>
        <!-- 普通字段映射：column=数据库字段名，property=实体类属性名 -->
        <result column="campus_id" property="campusId"/>
        <result column="location_name" property="locationName"/>
        <result column="location_type" property="locationType"/>
        <result column="latitude" property="latitude"/>
        <result column="longitude" property="longitude"/>
        <result column="status" property="status"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <!-- 1. 按校区ID查询启用的位置（你原有的查询） -->
    <select id="selectEnabledByCampus" resultMap="MpLocationResultMap">
        SELECT id, campus_id, location_name, location_type,
               latitude, longitude, status, create_time, update_time
        FROM ccp_location
        WHERE campus_id = #{campusId}
          AND status = 1
        ORDER BY location_name ASC
    </select>

    <!-- 2. 按ID查询单条位置信息 -->
    <select id="selectMpLocationById" resultMap="MpLocationResultMap">
        SELECT id, campus_id, location_name, location_type,
               latitude, longitude, status, create_time, update_time
        FROM ccp_location
        WHERE id = #{id}
    </select>

    <!-- 3. 新增位置信息 -->
    <insert id="insertMpLocation" parameterType="org.ba7lgj.ccp.miniprogram.domain.MpLocation">
        INSERT INTO ccp_location (
        campus_id, location_name, location_type, latitude,
        longitude, status, create_time, update_time
        ) VALUES (
        #{campusId}, #{locationName}, #{locationType}, #{latitude},
        #{longitude}, #{status}, #{createTime}, #{updateTime}
        )
        <!-- 可选：返回自增主键 -->
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <!-- 4. 修改位置信息（全字段更新） -->
    <update id="updateMpLocation" parameterType="org.ba7lgj.ccp.miniprogram.domain.MpLocation">
        UPDATE ccp_location
        SET
            campus_id = #{campusId},
            location_name = #{locationName},
            location_type = #{locationType},
            latitude = #{latitude},
            longitude = #{longitude},
            status = #{status},
            update_time = #{updateTime}
        WHERE id = #{id}
    </update>

    <!-- 5. 按ID删除位置（逻辑删除：修改status为0，推荐） -->
    <update id="deleteMpLocationById" parameterType="java.lang.Long">
        UPDATE ccp_location
        SET status = 0, update_time = NOW()
        WHERE id = #{id}
    </update>

    <!-- 6. 批量查询位置（按ID列表） -->
    <select id="selectMpLocationByIds" resultMap="MpLocationResultMap">
        SELECT id, campus_id, location_name, location_type,
        latitude, longitude, status, create_time, update_time
        FROM ccp_location
        WHERE id IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
        AND status = 1
    </select>

</mapper>